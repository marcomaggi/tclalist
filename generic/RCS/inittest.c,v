head	1.1;
branch	1.1.1;
access;
symbols;
locks; strict;
comment	@ * @;


1.1
date	2003.09.12.17.30.09;	author marco;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.09.12.17.30.09;	author marco;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.09.12.17.35.16;	author marco;	state Exp;
branches;
next	;


desc
@initialisation functions for the stub's test library
@


1.1
log
@Initial revision
@
text
@/* init.c --
   
   Part of: Alist
   Contents: initialisation functions
   Date: Sat Apr 27, 2002
   
   Abstract
   
   
   
   Copyright (c) 2002, 2003 Marco Maggi
   
   The author hereby grant  permission to use, copy, modify, distribute,
   and  license this  software and  its documentation  for  any purpose,
   provided that  existing copyright notices are retained  in all copies
   and that  this notice is  included verbatim in any  distributions. No
   written agreement, license, or royalty fee is required for any of the
   authorized uses.   Modifications to this software  may be copyrighted
   by their  authors and need  not follow the licensing  terms described
   here, provided that the new  terms are clearly indicated on the first
   page of each file where they apply.
   
   IN NO EVENT  SHALL THE AUTHOR OR DISTRIBUTORS BE  LIABLE TO ANY PARTY
   FOR DIRECT,  INDIRECT, SPECIAL, INCIDENTAL,  OR CONSEQUENTIAL DAMAGES
   ARISING OUT  OF THE USE OF  THIS SOFTWARE, ITS  DOCUMENTATION, OR ANY
   DERIVATIVES  THEREOF, EVEN  IF THE  AUTHOR HAVE  BEEN ADVISED  OF THE
   POSSIBILITY OF SUCH DAMAGE.
   
   THE  AUTHOR AND  DISTRIBUTORS SPECIFICALLY  DISCLAIM  ANY WARRANTIES,
   INCLUDING,   BUT  NOT   LIMITED   TO,  THE   IMPLIED  WARRANTIES   OF
   MERCHANTABILITY,    FITNESS   FOR    A   PARTICULAR    PURPOSE,   AND
   NON-INFRINGEMENT.  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, AND
   THE   AUTHOR  AND   DISTRIBUTORS  HAVE   NO  OBLIGATION   TO  PROVIDE
   MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

   $Id: init.c,v 1.31 2003/08/18 19:53:04 marco Exp $
*/



/** ------------------------------------------------------------
 ** Header files.
 ** ----------------------------------------------------------*/

#ifndef ALIST_STUBS_TEST
#  include "alistInt.h"
#else
#  include "alist.h"
#  include "alistTest.h"
#endif



/** ------------------------------------------------------------
 ** Prototypes.
 ** ----------------------------------------------------------*/

#ifndef ALIST_STUBS_TEST
EXTERN int	Alist_Init		_ANSI_ARGS_((Tcl_Interp *interp));
EXTERN int	Alist_SafeInit		_ANSI_ARGS_((Tcl_Interp *interp));
#else
EXTERN int	Alisttest_Init		_ANSI_ARGS_((Tcl_Interp *interp));
EXTERN int	Alisttest_SafeInit	_ANSI_ARGS_((Tcl_Interp *interp));
#endif



/** ------------------------------------------------------------
 ** Global variables.
 ** ----------------------------------------------------------*/

#ifndef ALIST_STUBS_TEST

EXTERN CONST Alist_StubsTable		alistStubs;

EXTERN int
Alist_Init (Tcl_Interp *interp)
{
#ifdef ALIST_ENABLE_NAMESPACE
  int e;
  Tcl_Obj *obj;
  static char script[] = "namespace eval alist { namespace export \\[a-z\\]* }";
#endif
  

#ifdef USE_TCL_STUBS
  if (Tcl_InitStubs(interp, "8.2", 0) == NULL) {
    return TCL_ERROR;
  }
#endif

#ifdef ALIST_ENABLE_NAMESPACE
  obj = Tcl_NewStringObj(script, -1);
  Tcl_IncrRefCount(obj);
  e = Tcl_EvalObjEx(interp, obj, 0);
  Tcl_DecrRefCount(obj);
  if (e != TCL_OK)
    {
      return TCL_ERROR;
    }

  Tcl_CreateObjCommand(interp, "alist::at",	AlistAtCmd,	NULL, NULL);
  Tcl_CreateObjCommand(interp, "alist::assign", AlistAssignCmd, NULL, NULL);
  Tcl_CreateObjCommand(interp, "alist::names",	AlistNamesCmd,	NULL, NULL);
  Tcl_CreateObjCommand(interp, "alist::values", AlistValuesCmd, NULL, NULL);
  Tcl_CreateObjCommand(interp, "alist::version",AlistVersionCmd,NULL, NULL);
#else
  Tcl_CreateObjCommand(interp, "alist", AlistCmd, NULL, NULL);
#endif /* defined ALIST_ENABLE_NAMESPACE */

  return Tcl_PkgProvideEx(interp, "alist", QUOTED_VERSION,
			  (char *)&alistStubs);
}


#else /* if defined ALIST_STUBS_TEST */


EXTERN int
Alisttest_Init (Tcl_Interp *interp)
{
#ifdef ALIST_ENABLE_NAMESPACE
  int e;
  Tcl_Obj *obj;
  static char script[] = \
    "namespace eval alist { namespace export at assign names values version }";
#endif
  

#ifdef USE_TCL_STUBS
  if (Tcl_InitStubs(interp, "8.2", 0) == NULL) {
    return TCL_ERROR;
  }
#endif

#ifdef USE_BZTCL_STUBS
  if (Alist_InitStubs(interp, QUOTED_VERSION, 0) == NULL) {
    return TCL_ERROR;
  }
#endif


#ifdef ALIST_ENABLE_NAMESPACE
  obj = Tcl_NewStringObj(script, -1);
  Tcl_IncrRefCount(obj);
  e = Tcl_EvalObjEx(interp, obj, 0);
  Tcl_DecrRefCount(obj);
  if (e != TCL_OK)
    {
      return TCL_ERROR;
    }

  Tcl_CreateObjCommand(interp, "alisttest::at",	    AlistAtCmd,     NULL, NULL);
  Tcl_CreateObjCommand(interp, "alisttest::assign", AlistAssignCmd, NULL, NULL);
  Tcl_CreateObjCommand(interp, "alisttest::names",  AlistNamesCmd,  NULL, NULL);
  Tcl_CreateObjCommand(interp, "alisttest::values", AlistValuesCmd, NULL, NULL);
  Tcl_CreateObjCommand(interp, "alisttest::version",AlistVersionCmd,NULL, NULL);
#else
  Tcl_CreateObjCommand(interp, "alisttest", AlistCmd, NULL, NULL);
#endif /* defined ALIST_ENABLE_NAMESPACE */

  return Tcl_PkgProvide(interp, "alisttest", QUOTED_VERSION);
}

#endif


/* Alist_SafeInit --

	Initialise the package for a safe Tcl interp.

   Arguments:

	interp -	the invoking interpreter

   Results:

        Return TCL_OK or TCL_ERROR.

   Side effects:

        none

*/

#ifndef ALIST_STUBS_TEST
EXTERN int
Alist_SafeInit(Tcl_Interp *interp)
{
  return Alist_Init (interp);
}
#else
EXTERN int
Alisttest_SafeInit(Tcl_Interp *interp)
{
  return Alisttest_Init (interp);
}
#endif



/* end of file */
@


1.1.1.1
log
@Initial branch
@
text
@d36 1
a36 1
   $Id: inittest.c,v 1.1 2003/09/12 17:30:09 marco Exp $
@


1.1.1.2
log
@*** empty log message ***
@
text
@d36 1
a36 1
   $Id: inittest.c,v 1.1.1.1 2003/09/12 17:30:09 marco Exp marco $
d45 7
a51 1
#include "alistTest.h"
d58 4
d64 1
d67 4
d72 1
a72 2

/* Alisttest_Init --
d74 1
a74 1
	Initialises the package.
d76 15
a90 1
   Arguments:
d92 9
a100 1
	interp -	the interpreter in which load the package
d102 8
a109 1
   Results:
d111 3
a113 1
        Returns TCL_OK or TCL_ERROR.
a114 1
   Side effects:
d116 1
a116 1
        None.
a117 1
*/
a121 2
  int	e;

d123 1
d125 2
a126 1
  static char script[] = "namespace eval alisttest { namespace export \\[a-z\\]* }";
d136 6
a141 5
  e = Tcl_PkgProvide(interp, "alisttest", QUOTED_VERSION);
  if (e != TCL_OK)
    {
      return e;
    }
d153 1
a153 1
  Tcl_CreateObjCommand(interp, "alisttest::at",	AlistAtCmd,NULL, NULL);
d155 1
a155 1
  Tcl_CreateObjCommand(interp, "alisttest::names",AlistNamesCmd,NULL, NULL);
d162 1
a162 1
  return TCL_OK;
d164 3
d168 1
a168 1
/* Alisttest_SafeInit --
d186 7
d198 2
@
